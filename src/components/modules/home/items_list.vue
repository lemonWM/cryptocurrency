<template>

    <div v-if="state.loaded" class="preloader-home d-flex">
        <a-spin></a-spin>
    </div>

    <div v-else class="currency-list container">

        <a-card title="Card Title">

            <a-card-grid v-for="item in state.currencyItems" :key="item.id" style="width: 33.3333%; text-align: center">
                
                <div class="currency-item">
                    <div class="currency-item__header d-flex d-row">
                        <p>{{ item.name }}</p>
                        <router-link :to="{name: 'Crypto-single',  params: {id: item.id}}">Details</router-link>
                    </div>
                    <div class="currency-item__details d-flex d-col">
                        <p>{{ item.symbol }}</p>
                        <p>{{ item.priceUsd }} <span>USD</span></p>
                    </div>
                </div>

            </a-card-grid>
        
        </a-card>
    </div>

</template>

<script>
    import { computed, onMounted, reactive, watchEffect } from 'vue'
    import { useStore } from 'vuex'
    import axios from 'axios'
  

    export default {
        name: "Test",
        setup() {

            const store = useStore()
            const currencyItemsStore = computed(() => store.state.currencyList)
            const currencyFilter = computed(() => store.state.currencyFilter)

            const state = reactive({
                loaded: true,
                currencyItems: []
            })

            function changeStore(data) {

                store.commit('updateList', data)

                state.currencyItems = data
            };

            onMounted(() => {
                
                axios.get('https://api.coincap.io/v2/assets')
                .then(response => {  
                    
                    let arr = response.data.data

                    arr.forEach((e, i) => {
    
                        e.priceUsd = parseFloat( e.priceUsd ).toFixed(3)
                    });

                    changeStore(arr)
                    state.loaded = false
                })
                .catch(e => {
                    console.log(e);
                })
            });

            watchEffect(() => {

                if(currencyFilter.value) {

                    console.log(currencyFilter.value);
                    console.log();
                    
                    state.currencyItems = []
                }
            })

            return {
                changeStore, state
            }
        },

    }
</script>